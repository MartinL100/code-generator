<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>文件上传</title>
    <link type="text/css" rel="stylesheet" href="css/cbat.css">
</head>
<body>
<div class="cbat-main">
    <div class="cbat-input">
        <label>选择模板</label>
        <input type="file" name="file" id="file">
    </div>
    <div class="cbat-input">
        <label>所属模块</label>
        <select name="module" id="module">
        <option value="BPM">工作流</option>
        <option value="UDC">低代码</option>
        </select>
    </div>
    <div class="cbat-input">
        <label>类是否带前缀</label>
        是<input type="radio" name="classHasPrefix" value="true">
        否<input type="radio" name="classHasPrefix" value="false">
    </div>
    <div class="cbat-input">
        <input type="button" value="提交" onclick="test()">
    </div>
    <div class="cbat-input">
        <form method="post" action="/template" enctype="multipart/form-data">
            <input type="submit" value="数据模板下载">
        </form>
    </div>

</div>












    <script src="https://cdn.staticfile.org/jquery/2.0.0/jquery.min.js"></script>
    <script src="http://lib.h-ui.net/jquery.form/3.51.0/jquery.form.min.js"></script>

    <script>


        function test() {
            //js获取数据
            var module = document.getElementById("module").value;
            var imgFile = document.getElementById("file").files;   //文件是通过.files取数据
            var classHasPrefix= document.getElementsByName("classHasPrefix");
            for (var i = 0 ; i<classHasPrefix.length;i++){
                if (classHasPrefix[i].checked){
                    classHasPrefix = classHasPrefix[i].value
                }
            } 
            
            

            var formData = new FormData();  //通过FormData拼装数据
            formData.append("module", module);
            formData.append("classHasPrefix", classHasPrefix);
            formData.append("file", imgFile[0]);  //因为取出的文件是数组，所以取第一项

//通过ajax发送数据
            $.ajax({
                url: "/code",
                type: "post",
                contentType: false,
                data: formData,
                processData:false,
                success: function(result) {
                    // 创建get请求路径
                    let downloadUrl = "/downLoadCode?fileName="+result;
                    // 创建a标签
                    let label = $("<a>");
                    // 添加属性
                    label.prop("href",downloadUrl);
                    // 追加标签
                    $("body").append(label);
                    // 点击a标签，为什么要加[0]不懂，不加点击函数不生效
                    label[0].click();
                    // 点击后移除标签
                    label.remove();
                }
            });
        }

    </script>
</body>
</html>